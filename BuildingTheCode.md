

# Requirements and prerequisites #

Caveat #1: the main/complete build tree will ONLY work on GNU platforms, or Unix-like platforms which host GNU toolsets (including GNU-compatible versions of the basic system tools, gcc, and GNU Make 3.81). It won't compile as-is (or will compile but not link) on Cygwin or Mac platforms (i only have Linux boxes, so that's what my build tools target). i would really like to port (or get someone else to port) the tree to scons at some point (for platform compatibility), but i have no experience with scons. Once the tree is restructured how i want it, i'll revisit scons (which can live in parallel with my own personal favourite, Make).

Caveat #2: there is a minimal build configuration for scons, but it can't do much and requires manual tweaking of the SConstruct file. See the section on scons down below.

The sources have only two hard dependencies: [Google v8](http://code.google.com/p/v8/) and the STL (which comes with all sane C++ compilers and is also available separately via projects like [STLPort](http://stlport.sourceforge.net)). For plugins to work it needs (on Unix platforms) libdl or libltdl and v8-juice must be compiled as a shared library (the plugin model cannot work from within a static library for boring technical reasons). (For Windows platforms the DLL support needs no additional libraries.)

# Configuring and compiling #

The build is fairly conventional:

```
./configure ... options (see below) ...
make
make install # installs under the path defined by --prefix=/path
```

My default build options is `make -j2` for parallel building, so the tree is believed to build okay with parallel builds (if it doesn't, please file a bug report). That said, certain parts of the tree enforce that certain directory branches are built before others, so certain branches may not allow parallelization. Even without parallelization it builds quickly (currently (20101126) it takes about 12 seconds on a 3GHz PC).

The following configuration options are often helpful or necessary:

  * `--prefix=/dir` is the installation prefix and the default place under which it will look for v8 and any additional libraries (e.g. those needed by plugins). Using `--prefix=$HOME` is often a good choice, and it allows a non-root user to run the installation.
  * `--v8-prefix=/top/install/dir/of/v8` tells configure to look for v8 under the given dir. It expects to find `include/v8.h` and `lib/libv8(_g).(a|so)`. Tip: use `--prefix=$HOME` if you are a non-root user or do not want to install it globally.
  * `--enable-debug` turns on debugging options and tries to link against `libv8_g` instead of `libv8` (but will use the latter if it can't find the former).
  * `--help` shows many more options which you'll never need.
  * `--disable-plugins` makes the plugin loading features no-ops and disables the build of the core plugins. Plugins are automatically disabled if neither `-ldl` or `-lltdl` are found. Specific plugins might not get compiled because their plugin-specific prerequisites are not met (e.g. libsqlite3 or libncurses).
  * `--enable-warn` turns on the `-Wall` compilation flag.
  * `--enable-werror` turns on the `-Werror` compilation flag.

See SourceTreeOverview for info on how the tree is laid out.

# Installation #

Run `make install` to install the library under the directory specified by the `--prefix=/path` configure argument.

If you need to do a custom installation, here's what you'll need to copy (and to where):

  * `src/lib/juice/libv8-juice.*` should go somewhere in your linker path.
  * `src/include/v8` should be copied (recursively) to some top-level includes dir of your choice.
  * `src/client/shell/v8-juice-shell` can optionally be installed somewhere in your PATH.

The makefile also supports `make uninstall`.

# Using SCons #

As of 20090313 the tree has very minimal support for a build using SCons.

  * Tweak the top-most `SConstruct` file to set the path to your libv8 library and header.
  * If you are NOT on a Unix platform, also remove the reference to the library named "dl".
  * Building the shell app seems to require the static v8-juice library, even if it links against the shared library. This might be a bug particular to my platform or version of scons.

Finally, just type `scons`. All buildable objects will be created in the top of the source tree.

To install it, follow the instructions shown above for a manual installation.

Achtung: the scons build actually depends on certain header files which are generated by the make-based build process. The copies of those generated files "might" not be as current as their generated forms.

# Building on Windows and Mac #

Good luck! i use Windows only for gaming and i've been boycotting Apple since the mid 1990's, so i cannot personally support building on such platforms. i am happy to accept patches, or even whole new build options (e.g. a MSVC project file), for such platforms, but cannot personally test or maintain them.